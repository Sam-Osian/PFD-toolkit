{% extends "workbench/base.html" %}

{% block sidebar %}
    {% include "workbench/_sidebar.html" %}
{% endblock %}

{% block content %}
<div class="workbench settings-workbench">
    <section class="shell-panel reveal-up">
        <div class="section-card-header">
            <span class="section-kicker">Settings</span>
            <h3>Source and model configuration</h3>
            <p>Update model access, provider settings, and report window defaults.</p>
        </div>

        <form method="post" class="form-card config-form">
            {% csrf_token %}

            <div class="config-grid config-grid--three">
                <div class="field-group">
                    <label for="provider_override">Model provider</label>
                    <select id="provider_override" name="provider_override">
                        <option value="OpenAI" {% if provider == 'OpenAI' %}selected{% endif %}>OpenAI</option>
                        <option value="OpenRouter" {% if provider == 'OpenRouter' %}selected{% endif %}>OpenRouter</option>
                    </select>
                </div>
                <div class="field-group">
                    <label for="model_name">Model</label>
                    <select id="model_name" name="model_name">
                        <option value="gpt-4.1-mini" {% if model_name == 'gpt-4.1-mini' %}selected{% endif %}>GPT 4.1 Mini (+speed, -accuracy)</option>
                        <option value="gpt-4.1" {% if model_name == 'gpt-4.1' %}selected{% endif %}>GPT 4.1 (+accuracy, -speed)</option>
                    </select>
                </div>
                <div class="field-group">
                    <label for="max_parallel_workers">Parallel workers</label>
                    <input id="max_parallel_workers" name="max_parallel_workers" type="number" min="1" max="32" value="{{ max_parallel_workers }}">
                </div>
            </div>

            <div id="openai-fields" {% if provider == 'OpenRouter' %}class="hidden"{% endif %}>
                <div class="config-grid config-grid--two">
                    <div class="field-group">
                        <label for="openai_api_key">OpenAI API key</label>
                        <input id="openai_api_key" name="openai_api_key" type="password" value="{{ openai_api_key }}">
                    </div>
                    <div class="field-group">
                        <label for="openai_base_url">Custom OpenAI base URL (optional)</label>
                        <input id="openai_base_url" name="openai_base_url" value="{{ openai_base_url }}" placeholder="Leave blank for default endpoint">
                    </div>
                </div>
            </div>

            <div id="openrouter-fields" {% if provider != 'OpenRouter' %}class="hidden"{% endif %}>
                <div class="config-grid config-grid--two">
                    <div class="field-group">
                        <label for="openrouter_api_key">OpenRouter API key</label>
                        <input id="openrouter_api_key" name="openrouter_api_key" type="password" value="{{ openrouter_api_key }}">
                    </div>
                    <div class="field-group">
                        <label for="openrouter_base_url">OpenRouter API base</label>
                        <input id="openrouter_base_url" name="openrouter_base_url" value="{{ openrouter_base_url }}">
                    </div>
                </div>
            </div>

            <div class="config-grid config-grid--two">
                <div class="field-group">
                    <label for="report_start_date">Report start date</label>
                    <input id="report_start_date" name="report_start_date" type="date" value="{{ report_start_date }}">
                </div>
                <div class="field-group">
                    <label for="report_end_date">Report end date</label>
                    <input id="report_end_date" name="report_end_date" type="date" value="{{ report_end_date }}">
                </div>
            </div>

            <div class="config-grid config-grid--two config-grid--align-end">
                <div class="field-group">
                    <label for="n_reports">Limit recent reports (optional)</label>
                    <input id="n_reports" name="n_reports" type="text" placeholder="e.g. 1000">
                </div>
                <div class="field-group">
                    <label class="checkbox">
                        <input type="checkbox" name="refresh" checked>
                        <span>Force refresh from remote dataset</span>
                    </label>
                </div>
            </div>

            <div class="settings-actions">
                <button type="submit" name="action" value="save_settings" class="button-secondary">Save settings</button>
                <button type="submit" name="action" value="load_reports">Load reports</button>
            </div>
        </form>
    </section>
</div>
{% endblock %}
